From 76ed52ffd46939aa3627522bbe2ba87dd1d4f99d Mon Sep 17 00:00:00 2001
From: zhuchen <zhuchen@loongson.cn>
Date: Fri, 29 Jul 2022 19:48:28 +0800
Subject: [PATCH 4/5] Add-AES-Assembly-Optimization

---
 Configurations/00-base-templates.conf |    1 +
 crypto/aes/asm/aes-loongarch.pl       | 1302 +++++++++++++++++++++++++
 crypto/aes/build.info                 |    3 +
 3 files changed, 1306 insertions(+)
 create mode 100644 crypto/aes/asm/aes-loongarch.pl

diff --git a/Configurations/00-base-templates.conf b/Configurations/00-base-templates.conf
index 4c8037a..65ab101 100644
--- a/Configurations/00-base-templates.conf
+++ b/Configurations/00-base-templates.conf
@@ -288,6 +288,7 @@ my %targets=(
     loongarch64_asm => {
 	template	=> 1,
 	bn_asm_src      => "bn_asm.c loongarch-mont.S",
+	aes_asm_src     => "aes_cbc.c aes-loongarch.S",
 	poly1305_asm_src=> "poly1305-loongarch.S"
     },
     s390x_asm => {
diff --git a/crypto/aes/asm/aes-loongarch.pl b/crypto/aes/asm/aes-loongarch.pl
new file mode 100644
index 0000000..0d0acbf
--- /dev/null
+++ b/crypto/aes/asm/aes-loongarch.pl
@@ -0,0 +1,1302 @@
+#! /usr/bin/env perl
+# Copyright 20122018 The OpenSSL Project Authors. All Rights Reserved.
+# Licensed under the Apache License 2.0 (the "License").  You may not use
+# this file except in compliance with the License.  You can obtain a copy
+# in the file LICENSE in the source distribution or at
+# https://www.openssl.org/source/license.html
+#
+# ====================================================================
+# Written by lujinfeng & shichenlong & songding <lujinfeng@loongson.cn> &
+# <shichenlong@loongson.cn>  & <songding@loongson.cn> for the OpenSSL
+# project. The module is, however, dual licensed under OpenSSL and
+# CRYPTOGAMS licenses depending on where you obtain it.
+# For further details see http://www.openssl.org/~appro/cryptogams/.
+# ====================================================================
+
+# AES for LoongArch.
+#
+# May 2022
+#
+# Loongarch assembly optimization is added. Compared with the version
+# without any optimization, the performance of the optimized version under
+# 16K ~ 16384k data blocks has been improved by about 15%,
+# and there will be room for further optimization in the future
+#
+######################################################################
+# Here is register layout for LoongArch ABIs.
+
+($zero,$ra,$tp,$sp)=map("\$r$_",(0..3));
+($a0,$a1,$a2,$a3,$a4,$a5,$a6,$a7)=map("\$r$_",(4..11));
+($t0,$t1,$t2,$t3,$t4,$t5,$t6,$t7,$t8,$t9)=map("\$r$_",(12..21));
+($s0,$s1,$s2,$s3,$s4,$s5,$s6,$s7)=map("\$r$_",(23..30));
+($fp)=map("\$r$_",(22));
+
+    $PTR_LA = "li.d";
+    $PTR_ADD= "addi.d";
+    $PTR_INS= "bstrins.d";
+    $REG_S  = "st.d";
+    $REG_L  = "ld.d";
+    $PTR_SLL= "sll.d";
+    $SZREG  = 8;
+#
+# <appro@openssl.org>
+#
+######################################################################
+
+for (@ARGV) {	$output=$_ if (/\w[\w\-]*\.\w+$/);}
+open STDOUT,">$output";
+while (($output=shift) && ($output!~/\w[\w\-]*\.\w+$/)) {}
+open STDOUT,">$output";
+
+{{{
+my $FRAMESIZE=16*$SZREG;
+
+my ($inp,$out,$key,$Tbl)=($a0,$a1,$a2,$a3);
+my ($i0,$i1,$i2,$i3)=($t4,$t5,$t6,$t7);
+my ($s0,$s1,$s2,$s3,$s4,$s5,$s6,$s7) = map("\$r$_",(23..30));
+my ($key0,$cnt)=($t8,$fp);
+
+$code.=<<___;
+.align	5
+_loongarch_AES_encrypt:
+        ld.w     $t0,$key,0
+        ld.w     $t1,$key,4
+        ld.w     $t2,$key,8
+        ld.w     $t3,$key,12
+        ld.w     $cnt,$key,240
+        $PTR_ADD $key0,$key,16
+
+        xor      $a4,$a4,$t0
+        xor      $a5,$a5,$t1
+        xor      $a6,$a6,$t2
+        xor      $a7,$a7,$t3
+        addi.w   $cnt,$cnt,-1
+        srli.w   $i0,$a5,6
+
+.Loop_enc:
+        srli.w   $i1,$a6,6
+        srli.w   $i2,$a7,6
+        srli.w   $i3,$a4,6
+        andi     $i0,$i0,0x3fc
+        andi     $i1,$i1,0x3fc
+        andi     $i2,$i2,0x3fc
+        andi     $i3,$i3,0x3fc
+        add.d    $i0,$i0,$Tbl
+        add.d    $i1,$i1,$Tbl
+        add.d    $i2,$i2,$Tbl
+        add.d    $i3,$i3,$Tbl
+        ld.w     $t0,$i0,0              # Te1[s1>>16]
+        srli.w   $i0,$a6,14
+        ld.w     $t1,$i1,0              # Te1[s2>>16]
+        srli.w   $i1,$a7,14
+        ld.w     $t2,$i2,0              # Te1[s3>>16]
+        srli.w   $i2,$a4,14
+        ld.w     $t3,$i3,0              # Te1[s0>>16]
+        srli.w   $i3,$a5,14
+
+        andi     $i0,$i0,0x3fc
+        andi     $i1,$i1,0x3fc
+        andi     $i2,$i2,0x3fc
+        andi     $i3,$i3,0x3fc
+        add.d    $i0,$i0,$Tbl
+        add.d    $i1,$i1,$Tbl
+        add.d    $i2,$i2,$Tbl
+        add.d    $i3,$i3,$Tbl
+
+        rotri.w  $t0,$t0,24
+        rotri.w  $t1,$t1,24
+        rotri.w  $t2,$t2,24
+        rotri.w  $t3,$t3,24
+
+        ld.w     $s0,$i0,0              # Te2[s2>>8]
+        srli.w   $i0,$a7,22
+        ld.w     $s1,$i1,0              # Te2[s3>>8]
+        srli.w   $i1,$a4,22
+        ld.w     $s2,$i2,0              # Te2[s0>>8]
+        srli.w   $i2,$a5,22
+        ld.w     $s3,$i3,0              # Te2[s1>>8]
+        srli.w   $i3,$a6,22
+
+        andi    $i0,$i0,0x3fc
+        andi    $i1,$i1,0x3fc
+        andi    $i2,$i2,0x3fc
+        andi    $i3,$i3,0x3fc
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        ld.w    $s4,$i0,0              # Te3[s3]
+        $PTR_INS $i0,$a4,9,2
+        ld.w    $s5,$i1,0              # Te3[s0]
+        $PTR_INS $i1,$a5,9,2
+        ld.w    $s6,$i2,0             # Te3[s1]
+        $PTR_INS $i2,$a6,9,2
+        ld.w    $s7,$i3,0             # Te3[s2]
+        $PTR_INS $i3,$a7,9,2
+
+        rotri.w $s0,$s0,16
+        rotri.w $s1,$s1,16
+        rotri.w $s2,$s2,16
+        rotri.w $s3,$s3,16
+
+        rotri.w $s4,$s4,8
+        rotri.w $s5,$s5,8
+        rotri.w $s6,$s6,8
+        rotri.w $s7,$s7,8
+
+        xor     $t0,$t0,$s0
+        ld.w    $s0,$i0,0             # Te0[s0>>24]
+        xor     $t1,$t1,$s1
+        ld.w    $s1,$i1,0             # Te0[s1>>24]
+        xor     $t2,$t2,$s2
+        ld.w    $s2,$i2,0             # Te0[s2>>24]
+        xor     $t3,$t3,$s3
+        ld.w    $s3,$i3,0             # Te0[s3>>24]
+        xor     $t0,$t0,$s4
+        ld.w    $a4,$key0,0
+        xor     $t1,$t1,$s5
+        ld.w    $a5,$key0,4
+        xor     $t2,$t2,$s6
+        ld.w    $a6,$key0,8
+        xor     $t3,$t3,$s7
+        ld.w    $a7,$key0,12
+
+        xor     $t0,$t0,$s0
+        xor     $t1,$t1,$s1
+        xor     $t2,$t2,$s2
+        xor     $t3,$t3,$s3
+
+        addi.w  $cnt,$cnt,-1
+        $PTR_ADD $key0,$key0,16
+        xor     $a4,$a4,$t0
+        xor     $a5,$a5,$t1
+        xor     $a6,$a6,$t2
+        xor     $a7,$a7,$t3
+        srli.w  $i0,$a5,6
+        bnez    $cnt,.Loop_enc
+
+        srli.w  $i1,$a6,6
+        srli.w  $i2,$a7,6
+        srli.w  $i3,$a4,6
+        andi    $i0,$i0,0x3fc
+        andi    $i1,$i1,0x3fc
+        andi    $i2,$i2,0x3fc
+        andi    $i3,$i3,0x3fc
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+        ld.bu   $t0,$i0,2               # Te4[s1>>16]
+        srli.w  $i0,$a6,14
+        ld.bu   $t1,$i1,2               # Te4[s2>>16]
+        srli.w  $i1,$a7,14
+        ld.bu   $t2,$i2,2               # Te4[s3>>16]
+        srli.w  $i2,$a4,14
+        ld.bu   $t3,$i3,2               # Te4[s0>>16]
+        srli.w  $i3,$a5,14
+
+        andi    $i0,$i0,0x3fc
+        andi    $i1,$i1,0x3fc
+        andi    $i2,$i2,0x3fc
+        andi    $i3,$i3,0x3fc
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        ld.bu   $s0,$i0,2               # Te4[s2>>8]
+        $PTR_INS $i0,$a4,9,2
+        ld.bu   $s1,$i1,2               # Te4[s3>>8]
+        $PTR_INS $i1,$a5,9,2
+        ld.bu   $s2,$i2,2               # Te4[s0>>8]
+        $PTR_INS $i2,$a6,9,2
+        ld.bu   $s3,$i3,2               # Te4[s1>>8]
+        $PTR_INS $i3,$a7,9,2
+
+        ld.bu   $s4,$i0,2               # Te4[s0>>24]
+        srli.w  $i0,$a7,22
+        ld.bu   $s5,$i1,2               # Te4[s1>>24]
+        srli.w  $i1,$a4,22
+        ld.bu   $s6,$i2,2              # Te4[s2>>24]
+        srli.w  $i2,$a5,22
+        ld.bu   $s7,$i3,2              # Te4[s3>>24]
+        srli.w  $i3,$a6,22
+
+        andi    $i0,$i0,0x3fc
+        andi    $i1,$i1,0x3fc
+        andi    $i2,$i2,0x3fc
+        andi    $i3,$i3,0x3fc
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        slli.w  $t0,$t0,8
+        slli.w  $t1,$t1,8
+        slli.w  $t2,$t2,8
+        slli.w  $t3,$t3,8
+
+        bstrins.w $t0,$s0,23,16
+        ld.bu   $s0,$i0,2               # Te4[s3]
+        bstrins.w $t1,$s1,23,16
+        ld.bu   $s1,$i1,2               # Te4[s0]
+        bstrins.w $t2,$s2,23,16
+        ld.bu   $s2,$i2,2               # Te4[s1]
+        bstrins.w $t3,$s3,23,16
+        ld.bu   $s3,$i3,2               # Te4[s2]
+
+        bstrins.w $t0,$s4,7,0
+        ld.w    $a4,$key0,0
+        bstrins.w $t1,$s5,7,0
+        ld.w    $a5,$key0,4
+        bstrins.w $t2,$s6,7,0
+        ld.w    $a6,$key0,8
+        bstrins.w $t3,$s7,7,0
+        ld.w    $a7,$key0,12
+
+        bstrins.w $t0,$s0,31,24
+        bstrins.w $t1,$s1,31,24
+        bstrins.w $t2,$s2,31,24
+        bstrins.w $t3,$s3,31,24
+
+        xor     $a4,$a4,$t0
+        xor     $a5,$a5,$t1
+        xor     $a6,$a6,$t2
+        xor     $a7,$a7,$t3
+        jr      $ra
+
+.align	5
+.globl  AES_encrypt
+AES_encrypt:
+___
+$code.=<<___;
+        $PTR_ADD $sp,$sp,-1*$FRAMESIZE
+        $REG_S  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_S  $fp,$sp,$FRAMESIZE-2*$SZREG
+        $REG_S  $s7,$sp,$FRAMESIZE-3*$SZREG
+        $REG_S  $s6,$sp,$FRAMESIZE-4*$SZREG
+        $REG_S  $s5,$sp,$FRAMESIZE-5*$SZREG
+        $REG_S  $s4,$sp,$FRAMESIZE-6*$SZREG
+        $REG_S  $s3,$sp,$FRAMESIZE-7*$SZREG
+        $REG_S  $s2,$sp,$FRAMESIZE-8*$SZREG
+        $REG_S  $s1,$sp,$FRAMESIZE-9*$SZREG
+        $REG_S  $s0,$sp,$FRAMESIZE-10*$SZREG
+___
+
+$code.=<<___;
+        la.local $Tbl,AES_Te           # PIC-ified 'load address'
+
+        ld.w    $a4,$inp,0
+        ld.w    $a5,$inp,4
+        ld.w    $a6,$inp,8
+        ld.w    $a7,$inp,12
+        bl      _loongarch_AES_encrypt
+
+        st.w    $a4,$out,0
+        st.w    $a5,$out,4
+        st.w    $a6,$out,8
+        st.w    $a7,$out,12
+
+        $REG_L  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_L  $fp,$sp,$FRAMESIZE-2*$SZREG
+        $REG_L  $s7,$sp,$FRAMESIZE-3*$SZREG
+        $REG_L  $s6,$sp,$FRAMESIZE-4*$SZREG
+        $REG_L  $s5,$sp,$FRAMESIZE-5*$SZREG
+        $REG_L  $s4,$sp,$FRAMESIZE-6*$SZREG
+        $REG_L  $s3,$sp,$FRAMESIZE-7*$SZREG
+        $REG_L  $s2,$sp,$FRAMESIZE-8*$SZREG
+        $REG_L  $s1,$sp,$FRAMESIZE-9*$SZREG
+        $REG_L  $s0,$sp,$FRAMESIZE-10*$SZREG
+___
+$code.=<<___;
+
+        $PTR_ADD $sp,$sp,$FRAMESIZE
+        jr      $ra
+___
+
+$code.=<<___;
+.align	5
+_loongarch_AES_decrypt:
+        ld.w    $t0,$key,0
+        ld.w    $t1,$key,4
+        ld.w    $t2,$key,8
+        ld.w    $t3,$key,12
+        ld.w    $cnt,$key,240
+        $PTR_ADD $key0,$key,16
+        xor     $a4,$a4,$t0
+        xor     $a5,$a5,$t1
+        xor     $a6,$a6,$t2
+        xor     $a7,$a7,$t3
+
+        addi.w  $cnt,$cnt,-1
+        srli.w  $i0,$a7,6
+.Loop_dec:
+        srli.w  $i1,$a4,6
+        srli.w  $i2,$a5,6
+        srli.w  $i3,$a6,6
+
+        andi    $i0,$i0,0x3fc
+        andi    $i1,$i1,0x3fc
+        andi    $i2,$i2,0x3fc
+        andi    $i3,$i3,0x3fc
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        ld.w    $t0,$i0,0		# Td1[s3>>16]
+        srli.w  $i0,$a6,14
+        ld.w    $t1,$i1,0		# Td1[s0>>16]
+        srli.w  $i1,$a7,14
+        ld.w    $t2,$i2,0		# Td1[s1>>16]
+        srli.w  $i2,$a4,14
+        ld.w    $t3,$i3,0		# Td1[s2>>16]
+        srli.w  $i3,$a5,14
+
+
+        andi    $i0,$i0,0x3fc
+        andi    $i1,$i1,0x3fc
+        andi    $i2,$i2,0x3fc
+        andi    $i3,$i3,0x3fc
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        rotri.w $t0,$t0,24
+        rotri.w $t1,$t1,24
+        rotri.w $t2,$t2,24
+        rotri.w $t3,$t3,24
+        ld.w    $s0,$i0,0		# Td2[s2>>8]
+        srli.w  $i0,$a5,22
+        ld.w    $s1,$i1,0		# Td2[s3>>8]
+        srli.w  $i1,$a6,22
+        ld.w    $s2,$i2,0		# Td2[s0>>8]
+        srli.w  $i2,$a7,22
+        ld.w    $s3,$i3,0		# Td2[s1>>8]
+        srli.w  $i3,$a4,22
+
+        andi    $i0,$i0,0x3fc
+        andi    $i1,$i1,0x3fc
+        andi    $i2,$i2,0x3fc
+        andi    $i3,$i3,0x3fc
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        ld.w    $s4,$i0,0		# Td3[s1]
+        $PTR_INS $i0,$a4,9,2
+        ld.w    $s5,$i1,0		# Td3[s2]
+        $PTR_INS $i1,$a5,9,2
+        ld.w    $s6,$i2,0		# Td3[s3]
+        $PTR_INS $i2,$a6,9,2
+        ld.w    $s7,$i3,0		# Td3[s0]
+        $PTR_INS $i3,$a7,9,2
+
+        rotri.w $s0,$s0,16
+        rotri.w $s1,$s1,16
+        rotri.w $s2,$s2,16
+        rotri.w $s3,$s3,16
+
+        rotri.w $s4,$s4,8
+        rotri.w $s5,$s5,8
+        rotri.w $s6,$s6,8
+        rotri.w $s7,$s7,8
+
+        xor     $t0,$t0,$s0
+        ld.w    $s0,$i0,0		# Td0[s0>>24]
+        xor     $t1,$t1,$s1
+        ld.w    $s1,$i1,0		# Td0[s1>>24]
+        xor     $t2,$t2,$s2
+        ld.w    $s2,$i2,0		# Td0[s2>>24]
+        xor     $t3,$t3,$s3
+        ld.w    $s3,$i3,0		# Td0[s3>>24]
+        xor     $t0,$t0,$s4
+        ld.w    $a4,$key0,0
+        xor     $t1,$t1,$s5
+        ld.w    $a5,$key0,4
+        xor     $t2,$t2,$s6
+        ld.w    $a6,$key0,8
+        xor     $t3,$t3,$s7
+        ld.w    $a7,$key0,12
+
+        xor     $t0,$t0,$s0
+        xor     $t1,$t1,$s1
+        xor     $t2,$t2,$s2
+        xor     $t3,$t3,$s3
+
+        addi.w  $cnt,$cnt,-1
+        $PTR_ADD $key0,$key0,16
+        xor     $a4,$a4,$t0
+        xor     $a5,$a5,$t1
+        xor     $a6,$a6,$t2
+        xor     $a7,$a7,$t3
+
+        srli.w  $i0,$a7,6
+        bnez    $cnt,.Loop_dec
+        ld.w    $s0,$Tbl,1024		# prefetch Td4
+        srli.w  $i0,$a7,8
+        ld.w    $s1,$Tbl,1024+32
+        srli.w  $i1,$a4,8
+        ld.w    $s2,$Tbl,1024+64
+        srli.w  $i2,$a5,8
+        ld.w    $s3,$Tbl,1024+96
+        srli.w  $i3,$a6,8
+        ld.w    $s4,$Tbl,1024+128
+        andi    $i0,$i0,0xff
+        ld.w    $s5,$Tbl,1024+160
+        andi    $i1,$i1,0xff
+        ld.w    $s6,$Tbl,1024+192
+        andi    $i2,$i2,0xff
+        ld.w    $s7,$Tbl,1024+224
+        andi    $i3,$i3,0xff
+
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        ld.bu   $t0,$i0,1024		# Td4[s3>>16]
+        srli.w  $i0,$a6,16
+        ld.bu   $t1,$i1,1024		# Td4[s0>>16]
+        srli.w  $i1,$a7,16
+        ld.bu   $t2,$i2,1024		# Td4[s1>>16]
+        srli.w  $i2,$a4,16
+        ld.bu   $t3,$i3,1024		# Td4[s2>>16]
+        srli.w  $i3,$a5,16
+
+        andi    $i0,$i0,0xff
+        andi    $i1,$i1,0xff
+        andi    $i2,$i2,0xff
+        andi    $i3,$i3,0xff
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+
+        ld.bu   $s0,$i0,1024        # Td4[s2>>8]
+        $PTR_INS $i0,$a4,7,0
+        ld.bu   $s1,$i1,1024        # Td4[s3>>8]
+        $PTR_INS $i1,$a5,7,0
+        ld.bu   $s2,$i2,1024        # Td4[s0>>8]
+        $PTR_INS $i2,$a6,7,0
+        ld.bu   $s3,$i3,1024        # Td4[s1>>8]
+        $PTR_INS $i3,$a7,7,0
+
+        ld.bu   $s4,$i0,1024        # Td4[s0>>24]
+        srli.w  $i0,$a5,24
+        ld.bu   $s5,$i1,1024        # Td4[s1>>24]
+        srli.w  $i1,$a6,24
+        ld.bu   $s6,$i2,1024       # Td4[s2>>24]
+        srli.w  $i2,$a7,24
+        ld.bu   $s7,$i3,1024       # Td4[s3>>24]
+        srli.w  $i3,$a4,24
+
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+        slli.w  $t0,$t0,8
+        slli.w  $t1,$t1,8
+        slli.w  $t2,$t2,8
+        slli.w  $t3,$t3,8
+
+        bstrins.w $t0,$s0,23,16
+        ld.bu   $s0,$i0,1024		# Td4[s1]
+        bstrins.w $t1,$s1,23,16
+        ld.bu   $s1,$i1,1024		# Td4[s2]
+        bstrins.w $t2,$s2,23,16
+        ld.bu   $s2,$i2,1024		# Td4[s3]
+        bstrins.w $t3,$s3,23,16
+        ld.bu   $s3,$i3,1024		# Td4[s0]
+
+        bstrins.w $t0,$s4,7,0
+        ld.w    $a4,$key0,0
+        bstrins.w $t1,$s5,7,0
+        ld.w    $a5,$key0,4
+        bstrins.w $t2,$s6,7,0
+        ld.w    $a6,$key0,8
+        bstrins.w $t3,$s7,7,0
+        ld.w    $a7,$key0,12
+
+        bstrins.w $t0,$s0,31,24
+        bstrins.w $t1,$s1,31,24
+        bstrins.w $t2,$s2,31,24
+        bstrins.w $t3,$s3,31,24
+
+        xor     $a4,$a4,$t0
+        xor     $a5,$a5,$t1
+        xor     $a6,$a6,$t2
+        xor     $a7,$a7,$t3
+        jr      $ra
+
+.align	5
+.globl	AES_decrypt
+AES_decrypt:
+___
+
+$code.=<<___;
+        $PTR_ADD $sp,$sp,-1*$FRAMESIZE
+        $REG_S  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_S  $fp,$sp,$FRAMESIZE-2*$SZREG
+        $REG_S  $s7,$sp,$FRAMESIZE-3*$SZREG
+        $REG_S  $s6,$sp,$FRAMESIZE-4*$SZREG
+        $REG_S  $s5,$sp,$FRAMESIZE-5*$SZREG
+        $REG_S  $s4,$sp,$FRAMESIZE-6*$SZREG
+        $REG_S  $s3,$sp,$FRAMESIZE-7*$SZREG
+        $REG_S  $s2,$sp,$FRAMESIZE-8*$SZREG
+        $REG_S  $s1,$sp,$FRAMESIZE-9*$SZREG
+        $REG_S  $s0,$sp,$FRAMESIZE-10*$SZREG
+___
+
+$code.=<<___;
+        la.local $Tbl,AES_Td		# PIC-ified 'load address'
+
+        ld.w    $a4,$inp,0
+        ld.w    $a5,$inp,4
+        ld.w    $a6,$inp,8
+        ld.w    $a7,$inp,12
+        bl      _loongarch_AES_decrypt
+
+        st.w    $a4,$out,0
+        st.w    $a5,$out,4
+        st.w    $a6,$out,8
+        st.w    $a7,$out,12
+
+        $REG_L  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_L  $fp,$sp,$FRAMESIZE-2*$SZREG
+        $REG_L  $s7,$sp,$FRAMESIZE-3*$SZREG
+        $REG_L  $s6,$sp,$FRAMESIZE-4*$SZREG
+        $REG_L  $s5,$sp,$FRAMESIZE-5*$SZREG
+        $REG_L  $s4,$sp,$FRAMESIZE-6*$SZREG
+        $REG_L  $s3,$sp,$FRAMESIZE-7*$SZREG
+        $REG_L  $s2,$sp,$FRAMESIZE-8*$SZREG
+        $REG_L  $s1,$sp,$FRAMESIZE-9*$SZREG
+        $REG_L  $s0,$sp,$FRAMESIZE-10*$SZREG
+___
+$code.=<<___;
+       $PTR_ADD $sp,$sp,$FRAMESIZE
+       jr       $ra
+___
+}}}
+
+{{{
+my $FRAMESIZE=8*$SZREG;
+my ($inp,$bits,$key,$Tbl)=($a0,$a1,$a2,$a3);
+my ($rk0,$rk1,$rk2,$rk3,$rk4,$rk5,$rk6,$rk7)=($a4,$a5,$a6,$a7,$t0,$t1,$t2,$t3);
+my ($i0,$i1,$i2,$i3)=($t4,$t5,$t6,$t7);
+my ($rcon,$cnt)=($t8,$fp);
+
+$code.=<<___;
+.align	5
+_loongarch_AES_set_encrypt_key:
+        li.w    $t4,-1
+        beqz    $inp,.Lekey_done
+        $PTR_ADD $rcon,$Tbl,256
+        beqz    $key,.Lekey_done
+
+        ld.w    $rk0,$inp,0		# load 128 bits
+        ld.w    $rk1,$inp,4
+        ld.w    $rk2,$inp,8
+        ld.w    $rk3,$inp,12
+        li.w    $t5,128
+
+        li.w    $cnt,10
+        beq     $bits,$t5,.L128bits
+        ld.w    $rk4,$inp,16		# load 192 bits
+        ld.w    $rk5,$inp,20
+        li.w    $t5,192
+        li.w    $cnt,8
+        beq	$bits,$t5,.L192bits
+
+        ld.w    $rk6,$inp,24		# load 256 bits
+        ld.w    $rk7,$inp,28
+        li.w    $t5,256
+
+        li.w    $cnt,7
+        beq	$bits,$t5,.L256bits
+        li.w    $t4,-2
+        b       .Lekey_done
+
+.align	4
+.L128bits:
+        srli.w  $i0,$rk3,16
+        srli.w  $i1,$rk3,8
+        andi    $i0,$i0,0xff
+        andi    $i1,$i1,0xff
+        andi    $i2,$rk3,0xff
+        srli.w  $i3,$rk3,24
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+        ld.bu   $i0,$i0,0
+        ld.bu   $i1,$i1,0
+        ld.bu   $i2,$i2,0
+        ld.bu   $i3,$i3,0
+
+        st.w    $rk0,$key,0
+        st.w    $rk1,$key,4
+        st.w    $rk2,$key,8
+        st.w    $rk3,$key,12
+        addi.w  $cnt,$cnt,-1
+        $PTR_ADD $key,$key,16
+
+        slli.w  $i0,$i0,8
+        slli.w  $i1,$i1,0
+        slli.w  $i2,$i2,24
+        slli.w  $i3,$i3,16
+        xor     $rk0,$rk0,$i0
+        ld.w    $i0,$rcon,0
+        xor     $rk0,$rk0,$i1
+        xor     $rk0,$rk0,$i2
+        xor     $rk0,$rk0,$i3
+        xor     $rk0,$rk0,$i0
+
+        xor     $rk1,$rk1,$rk0
+        xor     $rk2,$rk2,$rk1
+        xor     $rk3,$rk3,$rk2
+
+        $PTR_ADD $rcon,$rcon,4
+        bnez    $cnt,.L128bits
+
+        st.w    $rk0,$key,0
+        st.w    $rk1,$key,4
+        st.w    $rk2,$key,8
+        li.w    $cnt,10
+        st.w    $rk3,$key,12
+        li.w    $t4,0
+        st.w    $cnt,$key,80
+
+        $PTR_ADD $key,$key,-10*16
+        b       .Lekey_done
+
+.align	4
+.L192bits:
+        srli.w  $i0,$rk5,16
+        srli.w  $i1,$rk5,8
+        andi    $i0,$i0,0xff
+        andi    $i1,$i1,0xff
+        andi    $i2,$rk5,0xff
+        srli.w  $i3,$rk5,24
+
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+        ld.bu   $i0,$i0,0
+        ld.bu   $i1,$i1,0
+        ld.bu   $i2,$i2,0
+        ld.bu   $i3,$i3,0
+
+        st.w    $rk0,$key,0
+        st.w    $rk1,$key,4
+        st.w    $rk2,$key,8
+        st.w    $rk3,$key,12
+        st.w    $rk4,$key,16
+        st.w    $rk5,$key,20
+        addi.w  $cnt,$cnt,-1
+        $PTR_ADD $key,$key,24
+
+        slli.w  $i0,$i0,8
+        slli.w  $i1,$i1,0
+        slli.w  $i2,$i2,24
+        slli.w  $i3,$i3,16
+
+        xor     $rk0,$rk0,$i0
+        ld.w    $i0,$rcon,0
+        xor     $rk0,$rk0,$i1
+        xor     $rk0,$rk0,$i2
+        xor     $rk0,$rk0,$i3
+        xor     $rk0,$rk0,$i0
+        xor     $rk1,$rk1,$rk0
+        xor     $rk2,$rk2,$rk1
+        xor     $rk3,$rk3,$rk2
+        xor     $rk4,$rk4,$rk3
+        xor     $rk5,$rk5,$rk4
+
+        $PTR_ADD $rcon,$rcon,4
+        bnez    $cnt,.L192bits
+
+        st.w    $rk0,$key,0
+        st.w    $rk1,$key,4
+        st.w    $rk2,$key,8
+        li.w    $cnt,12
+        st.w    $rk3,$key,12
+        li.w    $t4,0
+        st.w    $cnt,$key,48
+
+        $PTR_ADD $key,$key,-12*16
+        b       .Lekey_done
+
+.align	4
+.L256bits:
+        srli.w  $i0,$rk7,16
+        srli.w  $i1,$rk7,8
+        andi    $i0,$i0,0xff
+        andi    $i1,$i1,0xff
+        andi    $i2,$rk7,0xff
+        srli.w  $i3,$rk7,24
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+        ld.bu   $i0,$i0,0
+        ld.bu   $i1,$i1,0
+        ld.bu   $i2,$i2,0
+        ld.bu   $i3,$i3,0
+
+        st.w    $rk0,$key,0
+        st.w    $rk1,$key,4
+        st.w    $rk2,$key,8
+        st.w    $rk3,$key,12
+        st.w    $rk4,$key,16
+        st.w    $rk5,$key,20
+        st.w    $rk6,$key,24
+        st.w    $rk7,$key,28
+        addi.w  $cnt,$cnt,-1
+
+        slli.w  $i0,$i0,8
+        slli.w  $i1,$i1,0
+        slli.w  $i2,$i2,24
+        slli.w  $i3,$i3,16
+
+        xor     $rk0,$rk0,$i0
+        ld.w    $i0,$rcon,0
+        xor     $rk0,$rk0,$i1
+        xor     $rk0,$rk0,$i2
+        xor     $rk0,$rk0,$i3
+        xor     $rk0,$rk0,$i0
+        xor     $rk1,$rk1,$rk0
+        xor     $rk2,$rk2,$rk1
+        xor     $rk3,$rk3,$rk2
+        beqz    $cnt,.L256bits_done
+
+        srli.w  $i0,$rk3,24
+        srli.w  $i1,$rk3,16
+        srli.w  $i2,$rk3,8
+        andi    $i3,$rk3,0xff
+        andi    $i1,$i1,0xff
+        andi    $i2,$i2,0xff
+        add.d   $i0,$i0,$Tbl
+        add.d   $i1,$i1,$Tbl
+        add.d   $i2,$i2,$Tbl
+        add.d   $i3,$i3,$Tbl
+        ld.bu   $i0,$i0,0
+        ld.bu   $i1,$i1,0
+        ld.bu   $i2,$i2,0
+        ld.bu   $i3,$i3,0
+        slli.w  $i0,$i0,24
+        slli.w  $i1,$i1,16
+        slli.w  $i2,$i2,8
+
+        xor     $rk4,$rk4,$i0
+        xor     $rk4,$rk4,$i1
+        xor     $rk4,$rk4,$i2
+        xor     $rk4,$rk4,$i3
+        xor     $rk5,$rk5,$rk4
+        xor     $rk6,$rk6,$rk5
+        xor     $rk7,$rk7,$rk6
+
+        $PTR_ADD $key,$key,32
+        $PTR_ADD $rcon,$rcon,4
+        b       .L256bits
+
+.L256bits_done:
+        st.w    $rk0,$key,32
+        st.w    $rk1,$key,36
+        st.w    $rk2,$key,40
+        li.w    $cnt,14
+        st.w    $rk3,$key,44
+        li.w    $t4,0
+        st.w    $cnt,$key,48
+        $PTR_ADD $key,$key,-12*16
+
+.Lekey_done:
+        jr      $ra
+.globl	AES_set_encrypt_key
+AES_set_encrypt_key:
+___
+
+$code.=<<___;
+        $PTR_ADD $sp,$sp,-1*$FRAMESIZE
+        $REG_S  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_S  $fp,$sp,$FRAMESIZE-2*$SZREG
+___
+
+$code.=<<___;
+        la.local $Tbl,AES_Te4		# PIC-ified 'load address'
+
+        bl      _loongarch_AES_set_encrypt_key
+        move    $a0,$t4
+        $REG_L  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_L  $fp,$sp,$FRAMESIZE-2*$SZREG
+___
+
+ $code.=<<___;
+        $PTR_ADD $sp,$sp,$FRAMESIZE
+        jr      $ra
+___
+
+
+my ($head,$tail)=($inp,$bits);
+my ($tp1,$tp2,$tp4,$tp8,$tp9,$tpb,$tpd,$tpe)=($a4,$a5,$a6,$a7,$t0,$t1,$t2,$t3);
+my ($m,$x80808080,$x7f7f7f7f,$x1b1b1b1b)=($t4,$t5,$t6,$t7);
+$code.=<<___;
+.align	5
+.globl	AES_set_decrypt_key
+AES_set_decrypt_key:
+___
+$code.=<<___;
+        $PTR_ADD $sp,$sp,-1*$FRAMESIZE
+        $REG_S  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_S  $fp,$sp,$FRAMESIZE-2*$SZREG
+___
+
+$code.=<<___;
+        la.local $Tbl,AES_Te4		# PIC-ified 'load address'
+        bl      _loongarch_AES_set_encrypt_key
+        bltz    $t4,.Ldkey_done
+
+        slli.w  $t5,$cnt,4
+        $PTR_ADD $head,$key,0
+        add.d   $tail,$key,$t5
+.align	4
+.Lswap:
+        ld.w    $rk0,$head,0
+        ld.w    $rk1,$head,4
+        ld.w    $rk2,$head,8
+        ld.w    $rk3,$head,12
+        ld.w    $rk4,$tail,0
+        ld.w    $rk5,$tail,4
+        ld.w    $rk6,$tail,8
+        ld.w    $rk7,$tail,12
+        st.w    $rk0,$tail,0
+        st.w    $rk1,$tail,4
+        st.w    $rk2,$tail,8
+        st.w    $rk3,$tail,12
+        $PTR_ADD $head,$head,16
+        $PTR_ADD $tail,$tail,-16
+        st.w    $rk4,$head,-16
+        st.w    $rk5,$head,-12
+        st.w    $rk6,$head,-8
+        st.w    $rk7,$head,-4
+        bne     $head,$tail,.Lswap
+
+        ld.w    $tp1,$key,16		# modulo-scheduled
+        lu12i.w $x80808080,0xFFFFFFFFFFF80800
+        addi.w  $cnt,$cnt,-1
+        li.d    $tp9,0x8080
+        or      $x80808080,$x80808080,$tp9
+        slli.w  $cnt,$cnt,2
+        $PTR_ADD $key,$key,16
+
+        lu12i.w $x1b1b1b1b,0x1b1b0
+        nor     $x7f7f7f7f,$zero,$x80808080
+        li.d    $tp9,0x1b1b
+        or      $x1b1b1b1b,$x1b1b1b1b,$tp9
+.align	4
+.Lmix:
+        and     $m,$tp1,$x80808080
+        and     $tp2,$tp1,$x7f7f7f7f
+        srli.w  $tp4,$m,7
+        add.w   $tp2,$tp2,$tp2		# tp2<<1
+        sub.w   $m,$m,$tp4
+        and     $m,$m,$x1b1b1b1b
+        xor     $tp2,$tp2,$m
+
+        and     $m,$tp2,$x80808080
+        and     $tp4,$tp2,$x7f7f7f7f
+        srli.w  $tp8,$m,7
+        add.w   $tp4,$tp4,$tp4		# tp4<<1
+        sub.w   $m,$m,$tp8
+        and     $m,$m,$x1b1b1b1b
+        xor     $tp4,$tp4,$m
+
+        and     $m,$tp4,$x80808080
+        and     $tp8,$tp4,$x7f7f7f7f
+        srli.w  $tp9,$m,7
+        add.w   $tp8,$tp8,$tp8		# tp8<<1
+        sub.w   $m,$m,$tp9
+        and     $m,$m,$x1b1b1b1b
+        xor     $tp8,$tp8,$m
+
+        xor     $tp9,$tp8,$tp1
+        xor     $tpe,$tp8,$tp4
+        xor     $tpb,$tp9,$tp2
+        xor     $tpd,$tp9,$tp4
+
+        rotri.w $tp1,$tpd,16
+        xor     $tpe,$tpe,$tp2
+        rotri.w $tp2,$tp9,24
+        xor     $tpe,$tpe,$tp1
+        rotri.w $tp4,$tpb,8
+        xor     $tpe,$tpe,$tp2
+        ld.w    $tp1,$key,4		# modulo-scheduled
+        xor     $tpe,$tpe,$tp4
+
+        addi.w  $cnt,$cnt,-1
+        st.w    $tpe,$key,0
+        $PTR_ADD $key,$key,4
+        bnez    $cnt,.Lmix
+        li.w    $t4,0
+.Ldkey_done:
+
+        move    $a0,$t4
+        $REG_L  $ra,$sp,$FRAMESIZE-1*$SZREG
+        $REG_L  $fp,$sp,$FRAMESIZE-2*$SZREG
+___
+
+$code.=<<___;
+        $PTR_ADD $sp,$sp,$FRAMESIZE
+        jr      $ra
+___
+}}}
+
+######################################################################
+# Tables are kept in endian-neutral manner
+$code.=<<___;
+.section .rodata
+.align	10
+AES_Te:
+.byte	0xc6,0x63,0x63,0xa5,	0xf8,0x7c,0x7c,0x84	# Te0
+.byte	0xee,0x77,0x77,0x99,	0xf6,0x7b,0x7b,0x8d
+.byte	0xff,0xf2,0xf2,0x0d,	0xd6,0x6b,0x6b,0xbd
+.byte	0xde,0x6f,0x6f,0xb1,	0x91,0xc5,0xc5,0x54
+.byte	0x60,0x30,0x30,0x50,	0x02,0x01,0x01,0x03
+.byte	0xce,0x67,0x67,0xa9,	0x56,0x2b,0x2b,0x7d
+.byte	0xe7,0xfe,0xfe,0x19,	0xb5,0xd7,0xd7,0x62
+.byte	0x4d,0xab,0xab,0xe6,	0xec,0x76,0x76,0x9a
+.byte	0x8f,0xca,0xca,0x45,	0x1f,0x82,0x82,0x9d
+.byte	0x89,0xc9,0xc9,0x40,	0xfa,0x7d,0x7d,0x87
+.byte	0xef,0xfa,0xfa,0x15,	0xb2,0x59,0x59,0xeb
+.byte	0x8e,0x47,0x47,0xc9,	0xfb,0xf0,0xf0,0x0b
+.byte	0x41,0xad,0xad,0xec,	0xb3,0xd4,0xd4,0x67
+.byte	0x5f,0xa2,0xa2,0xfd,	0x45,0xaf,0xaf,0xea
+.byte	0x23,0x9c,0x9c,0xbf,	0x53,0xa4,0xa4,0xf7
+.byte	0xe4,0x72,0x72,0x96,	0x9b,0xc0,0xc0,0x5b
+.byte	0x75,0xb7,0xb7,0xc2,	0xe1,0xfd,0xfd,0x1c
+.byte	0x3d,0x93,0x93,0xae,	0x4c,0x26,0x26,0x6a
+.byte	0x6c,0x36,0x36,0x5a,	0x7e,0x3f,0x3f,0x41
+.byte	0xf5,0xf7,0xf7,0x02,	0x83,0xcc,0xcc,0x4f
+.byte	0x68,0x34,0x34,0x5c,	0x51,0xa5,0xa5,0xf4
+.byte	0xd1,0xe5,0xe5,0x34,	0xf9,0xf1,0xf1,0x08
+.byte	0xe2,0x71,0x71,0x93,	0xab,0xd8,0xd8,0x73
+.byte	0x62,0x31,0x31,0x53,	0x2a,0x15,0x15,0x3f
+.byte	0x08,0x04,0x04,0x0c,	0x95,0xc7,0xc7,0x52
+.byte	0x46,0x23,0x23,0x65,	0x9d,0xc3,0xc3,0x5e
+.byte	0x30,0x18,0x18,0x28,	0x37,0x96,0x96,0xa1
+.byte	0x0a,0x05,0x05,0x0f,	0x2f,0x9a,0x9a,0xb5
+.byte	0x0e,0x07,0x07,0x09,	0x24,0x12,0x12,0x36
+.byte	0x1b,0x80,0x80,0x9b,	0xdf,0xe2,0xe2,0x3d
+.byte	0xcd,0xeb,0xeb,0x26,	0x4e,0x27,0x27,0x69
+.byte	0x7f,0xb2,0xb2,0xcd,	0xea,0x75,0x75,0x9f
+.byte	0x12,0x09,0x09,0x1b,	0x1d,0x83,0x83,0x9e
+.byte	0x58,0x2c,0x2c,0x74,	0x34,0x1a,0x1a,0x2e
+.byte	0x36,0x1b,0x1b,0x2d,	0xdc,0x6e,0x6e,0xb2
+.byte	0xb4,0x5a,0x5a,0xee,	0x5b,0xa0,0xa0,0xfb
+.byte	0xa4,0x52,0x52,0xf6,	0x76,0x3b,0x3b,0x4d
+.byte	0xb7,0xd6,0xd6,0x61,	0x7d,0xb3,0xb3,0xce
+.byte	0x52,0x29,0x29,0x7b,	0xdd,0xe3,0xe3,0x3e
+.byte	0x5e,0x2f,0x2f,0x71,	0x13,0x84,0x84,0x97
+.byte	0xa6,0x53,0x53,0xf5,	0xb9,0xd1,0xd1,0x68
+.byte	0x00,0x00,0x00,0x00,	0xc1,0xed,0xed,0x2c
+.byte	0x40,0x20,0x20,0x60,	0xe3,0xfc,0xfc,0x1f
+.byte	0x79,0xb1,0xb1,0xc8,	0xb6,0x5b,0x5b,0xed
+.byte	0xd4,0x6a,0x6a,0xbe,	0x8d,0xcb,0xcb,0x46
+.byte	0x67,0xbe,0xbe,0xd9,	0x72,0x39,0x39,0x4b
+.byte	0x94,0x4a,0x4a,0xde,	0x98,0x4c,0x4c,0xd4
+.byte	0xb0,0x58,0x58,0xe8,	0x85,0xcf,0xcf,0x4a
+.byte	0xbb,0xd0,0xd0,0x6b,	0xc5,0xef,0xef,0x2a
+.byte	0x4f,0xaa,0xaa,0xe5,	0xed,0xfb,0xfb,0x16
+.byte	0x86,0x43,0x43,0xc5,	0x9a,0x4d,0x4d,0xd7
+.byte	0x66,0x33,0x33,0x55,	0x11,0x85,0x85,0x94
+.byte	0x8a,0x45,0x45,0xcf,	0xe9,0xf9,0xf9,0x10
+.byte	0x04,0x02,0x02,0x06,	0xfe,0x7f,0x7f,0x81
+.byte	0xa0,0x50,0x50,0xf0,	0x78,0x3c,0x3c,0x44
+.byte	0x25,0x9f,0x9f,0xba,	0x4b,0xa8,0xa8,0xe3
+.byte	0xa2,0x51,0x51,0xf3,	0x5d,0xa3,0xa3,0xfe
+.byte	0x80,0x40,0x40,0xc0,	0x05,0x8f,0x8f,0x8a
+.byte	0x3f,0x92,0x92,0xad,	0x21,0x9d,0x9d,0xbc
+.byte	0x70,0x38,0x38,0x48,	0xf1,0xf5,0xf5,0x04
+.byte	0x63,0xbc,0xbc,0xdf,	0x77,0xb6,0xb6,0xc1
+.byte	0xaf,0xda,0xda,0x75,	0x42,0x21,0x21,0x63
+.byte	0x20,0x10,0x10,0x30,	0xe5,0xff,0xff,0x1a
+.byte	0xfd,0xf3,0xf3,0x0e,	0xbf,0xd2,0xd2,0x6d
+.byte	0x81,0xcd,0xcd,0x4c,	0x18,0x0c,0x0c,0x14
+.byte	0x26,0x13,0x13,0x35,	0xc3,0xec,0xec,0x2f
+.byte	0xbe,0x5f,0x5f,0xe1,	0x35,0x97,0x97,0xa2
+.byte	0x88,0x44,0x44,0xcc,	0x2e,0x17,0x17,0x39
+.byte	0x93,0xc4,0xc4,0x57,	0x55,0xa7,0xa7,0xf2
+.byte	0xfc,0x7e,0x7e,0x82,	0x7a,0x3d,0x3d,0x47
+.byte	0xc8,0x64,0x64,0xac,	0xba,0x5d,0x5d,0xe7
+.byte	0x32,0x19,0x19,0x2b,	0xe6,0x73,0x73,0x95
+.byte	0xc0,0x60,0x60,0xa0,	0x19,0x81,0x81,0x98
+.byte	0x9e,0x4f,0x4f,0xd1,	0xa3,0xdc,0xdc,0x7f
+.byte	0x44,0x22,0x22,0x66,	0x54,0x2a,0x2a,0x7e
+.byte	0x3b,0x90,0x90,0xab,	0x0b,0x88,0x88,0x83
+.byte	0x8c,0x46,0x46,0xca,	0xc7,0xee,0xee,0x29
+.byte	0x6b,0xb8,0xb8,0xd3,	0x28,0x14,0x14,0x3c
+.byte	0xa7,0xde,0xde,0x79,	0xbc,0x5e,0x5e,0xe2
+.byte	0x16,0x0b,0x0b,0x1d,	0xad,0xdb,0xdb,0x76
+.byte	0xdb,0xe0,0xe0,0x3b,	0x64,0x32,0x32,0x56
+.byte	0x74,0x3a,0x3a,0x4e,	0x14,0x0a,0x0a,0x1e
+.byte	0x92,0x49,0x49,0xdb,	0x0c,0x06,0x06,0x0a
+.byte	0x48,0x24,0x24,0x6c,	0xb8,0x5c,0x5c,0xe4
+.byte	0x9f,0xc2,0xc2,0x5d,	0xbd,0xd3,0xd3,0x6e
+.byte	0x43,0xac,0xac,0xef,	0xc4,0x62,0x62,0xa6
+.byte	0x39,0x91,0x91,0xa8,	0x31,0x95,0x95,0xa4
+.byte	0xd3,0xe4,0xe4,0x37,	0xf2,0x79,0x79,0x8b
+.byte	0xd5,0xe7,0xe7,0x32,	0x8b,0xc8,0xc8,0x43
+.byte	0x6e,0x37,0x37,0x59,	0xda,0x6d,0x6d,0xb7
+.byte	0x01,0x8d,0x8d,0x8c,	0xb1,0xd5,0xd5,0x64
+.byte	0x9c,0x4e,0x4e,0xd2,	0x49,0xa9,0xa9,0xe0
+.byte	0xd8,0x6c,0x6c,0xb4,	0xac,0x56,0x56,0xfa
+.byte	0xf3,0xf4,0xf4,0x07,	0xcf,0xea,0xea,0x25
+.byte	0xca,0x65,0x65,0xaf,	0xf4,0x7a,0x7a,0x8e
+.byte	0x47,0xae,0xae,0xe9,	0x10,0x08,0x08,0x18
+.byte	0x6f,0xba,0xba,0xd5,	0xf0,0x78,0x78,0x88
+.byte	0x4a,0x25,0x25,0x6f,	0x5c,0x2e,0x2e,0x72
+.byte	0x38,0x1c,0x1c,0x24,	0x57,0xa6,0xa6,0xf1
+.byte	0x73,0xb4,0xb4,0xc7,	0x97,0xc6,0xc6,0x51
+.byte	0xcb,0xe8,0xe8,0x23,	0xa1,0xdd,0xdd,0x7c
+.byte	0xe8,0x74,0x74,0x9c,	0x3e,0x1f,0x1f,0x21
+.byte	0x96,0x4b,0x4b,0xdd,	0x61,0xbd,0xbd,0xdc
+.byte	0x0d,0x8b,0x8b,0x86,	0x0f,0x8a,0x8a,0x85
+.byte	0xe0,0x70,0x70,0x90,	0x7c,0x3e,0x3e,0x42
+.byte	0x71,0xb5,0xb5,0xc4,	0xcc,0x66,0x66,0xaa
+.byte	0x90,0x48,0x48,0xd8,	0x06,0x03,0x03,0x05
+.byte	0xf7,0xf6,0xf6,0x01,	0x1c,0x0e,0x0e,0x12
+.byte	0xc2,0x61,0x61,0xa3,	0x6a,0x35,0x35,0x5f
+.byte	0xae,0x57,0x57,0xf9,	0x69,0xb9,0xb9,0xd0
+.byte	0x17,0x86,0x86,0x91,	0x99,0xc1,0xc1,0x58
+.byte	0x3a,0x1d,0x1d,0x27,	0x27,0x9e,0x9e,0xb9
+.byte	0xd9,0xe1,0xe1,0x38,	0xeb,0xf8,0xf8,0x13
+.byte	0x2b,0x98,0x98,0xb3,	0x22,0x11,0x11,0x33
+.byte	0xd2,0x69,0x69,0xbb,	0xa9,0xd9,0xd9,0x70
+.byte	0x07,0x8e,0x8e,0x89,	0x33,0x94,0x94,0xa7
+.byte	0x2d,0x9b,0x9b,0xb6,	0x3c,0x1e,0x1e,0x22
+.byte	0x15,0x87,0x87,0x92,	0xc9,0xe9,0xe9,0x20
+.byte	0x87,0xce,0xce,0x49,	0xaa,0x55,0x55,0xff
+.byte	0x50,0x28,0x28,0x78,	0xa5,0xdf,0xdf,0x7a
+.byte	0x03,0x8c,0x8c,0x8f,	0x59,0xa1,0xa1,0xf8
+.byte	0x09,0x89,0x89,0x80,	0x1a,0x0d,0x0d,0x17
+.byte	0x65,0xbf,0xbf,0xda,	0xd7,0xe6,0xe6,0x31
+.byte	0x84,0x42,0x42,0xc6,	0xd0,0x68,0x68,0xb8
+.byte	0x82,0x41,0x41,0xc3,	0x29,0x99,0x99,0xb0
+.byte	0x5a,0x2d,0x2d,0x77,	0x1e,0x0f,0x0f,0x11
+.byte	0x7b,0xb0,0xb0,0xcb,	0xa8,0x54,0x54,0xfc
+.byte	0x6d,0xbb,0xbb,0xd6,	0x2c,0x16,0x16,0x3a
+
+AES_Td:
+.byte	0x51,0xf4,0xa7,0x50,	0x7e,0x41,0x65,0x53	# Td0
+.byte	0x1a,0x17,0xa4,0xc3,	0x3a,0x27,0x5e,0x96
+.byte	0x3b,0xab,0x6b,0xcb,	0x1f,0x9d,0x45,0xf1
+.byte	0xac,0xfa,0x58,0xab,	0x4b,0xe3,0x03,0x93
+.byte	0x20,0x30,0xfa,0x55,	0xad,0x76,0x6d,0xf6
+.byte	0x88,0xcc,0x76,0x91,	0xf5,0x02,0x4c,0x25
+.byte	0x4f,0xe5,0xd7,0xfc,	0xc5,0x2a,0xcb,0xd7
+.byte	0x26,0x35,0x44,0x80,	0xb5,0x62,0xa3,0x8f
+.byte	0xde,0xb1,0x5a,0x49,	0x25,0xba,0x1b,0x67
+.byte	0x45,0xea,0x0e,0x98,	0x5d,0xfe,0xc0,0xe1
+.byte	0xc3,0x2f,0x75,0x02,	0x81,0x4c,0xf0,0x12
+.byte	0x8d,0x46,0x97,0xa3,	0x6b,0xd3,0xf9,0xc6
+.byte	0x03,0x8f,0x5f,0xe7,	0x15,0x92,0x9c,0x95
+.byte	0xbf,0x6d,0x7a,0xeb,	0x95,0x52,0x59,0xda
+.byte	0xd4,0xbe,0x83,0x2d,	0x58,0x74,0x21,0xd3
+.byte	0x49,0xe0,0x69,0x29,	0x8e,0xc9,0xc8,0x44
+.byte	0x75,0xc2,0x89,0x6a,	0xf4,0x8e,0x79,0x78
+.byte	0x99,0x58,0x3e,0x6b,	0x27,0xb9,0x71,0xdd
+.byte	0xbe,0xe1,0x4f,0xb6,	0xf0,0x88,0xad,0x17
+.byte	0xc9,0x20,0xac,0x66,	0x7d,0xce,0x3a,0xb4
+.byte	0x63,0xdf,0x4a,0x18,	0xe5,0x1a,0x31,0x82
+.byte	0x97,0x51,0x33,0x60,	0x62,0x53,0x7f,0x45
+.byte	0xb1,0x64,0x77,0xe0,	0xbb,0x6b,0xae,0x84
+.byte	0xfe,0x81,0xa0,0x1c,	0xf9,0x08,0x2b,0x94
+.byte	0x70,0x48,0x68,0x58,	0x8f,0x45,0xfd,0x19
+.byte	0x94,0xde,0x6c,0x87,	0x52,0x7b,0xf8,0xb7
+.byte	0xab,0x73,0xd3,0x23,	0x72,0x4b,0x02,0xe2
+.byte	0xe3,0x1f,0x8f,0x57,	0x66,0x55,0xab,0x2a
+.byte	0xb2,0xeb,0x28,0x07,	0x2f,0xb5,0xc2,0x03
+.byte	0x86,0xc5,0x7b,0x9a,	0xd3,0x37,0x08,0xa5
+.byte	0x30,0x28,0x87,0xf2,	0x23,0xbf,0xa5,0xb2
+.byte	0x02,0x03,0x6a,0xba,	0xed,0x16,0x82,0x5c
+.byte	0x8a,0xcf,0x1c,0x2b,	0xa7,0x79,0xb4,0x92
+.byte	0xf3,0x07,0xf2,0xf0,	0x4e,0x69,0xe2,0xa1
+.byte	0x65,0xda,0xf4,0xcd,	0x06,0x05,0xbe,0xd5
+.byte	0xd1,0x34,0x62,0x1f,	0xc4,0xa6,0xfe,0x8a
+.byte	0x34,0x2e,0x53,0x9d,	0xa2,0xf3,0x55,0xa0
+.byte	0x05,0x8a,0xe1,0x32,	0xa4,0xf6,0xeb,0x75
+.byte	0x0b,0x83,0xec,0x39,	0x40,0x60,0xef,0xaa
+.byte	0x5e,0x71,0x9f,0x06,	0xbd,0x6e,0x10,0x51
+.byte	0x3e,0x21,0x8a,0xf9,	0x96,0xdd,0x06,0x3d
+.byte	0xdd,0x3e,0x05,0xae,	0x4d,0xe6,0xbd,0x46
+.byte	0x91,0x54,0x8d,0xb5,	0x71,0xc4,0x5d,0x05
+.byte	0x04,0x06,0xd4,0x6f,	0x60,0x50,0x15,0xff
+.byte	0x19,0x98,0xfb,0x24,	0xd6,0xbd,0xe9,0x97
+.byte	0x89,0x40,0x43,0xcc,	0x67,0xd9,0x9e,0x77
+.byte	0xb0,0xe8,0x42,0xbd,	0x07,0x89,0x8b,0x88
+.byte	0xe7,0x19,0x5b,0x38,	0x79,0xc8,0xee,0xdb
+.byte	0xa1,0x7c,0x0a,0x47,	0x7c,0x42,0x0f,0xe9
+.byte	0xf8,0x84,0x1e,0xc9,	0x00,0x00,0x00,0x00
+.byte	0x09,0x80,0x86,0x83,	0x32,0x2b,0xed,0x48
+.byte	0x1e,0x11,0x70,0xac,	0x6c,0x5a,0x72,0x4e
+.byte	0xfd,0x0e,0xff,0xfb,	0x0f,0x85,0x38,0x56
+.byte	0x3d,0xae,0xd5,0x1e,	0x36,0x2d,0x39,0x27
+.byte	0x0a,0x0f,0xd9,0x64,	0x68,0x5c,0xa6,0x21
+.byte	0x9b,0x5b,0x54,0xd1,	0x24,0x36,0x2e,0x3a
+.byte	0x0c,0x0a,0x67,0xb1,	0x93,0x57,0xe7,0x0f
+.byte	0xb4,0xee,0x96,0xd2,	0x1b,0x9b,0x91,0x9e
+.byte	0x80,0xc0,0xc5,0x4f,	0x61,0xdc,0x20,0xa2
+.byte	0x5a,0x77,0x4b,0x69,	0x1c,0x12,0x1a,0x16
+.byte	0xe2,0x93,0xba,0x0a,	0xc0,0xa0,0x2a,0xe5
+.byte	0x3c,0x22,0xe0,0x43,	0x12,0x1b,0x17,0x1d
+.byte	0x0e,0x09,0x0d,0x0b,	0xf2,0x8b,0xc7,0xad
+.byte	0x2d,0xb6,0xa8,0xb9,	0x14,0x1e,0xa9,0xc8
+.byte	0x57,0xf1,0x19,0x85,	0xaf,0x75,0x07,0x4c
+.byte	0xee,0x99,0xdd,0xbb,	0xa3,0x7f,0x60,0xfd
+.byte	0xf7,0x01,0x26,0x9f,	0x5c,0x72,0xf5,0xbc
+.byte	0x44,0x66,0x3b,0xc5,	0x5b,0xfb,0x7e,0x34
+.byte	0x8b,0x43,0x29,0x76,	0xcb,0x23,0xc6,0xdc
+.byte	0xb6,0xed,0xfc,0x68,	0xb8,0xe4,0xf1,0x63
+.byte	0xd7,0x31,0xdc,0xca,	0x42,0x63,0x85,0x10
+.byte	0x13,0x97,0x22,0x40,	0x84,0xc6,0x11,0x20
+.byte	0x85,0x4a,0x24,0x7d,	0xd2,0xbb,0x3d,0xf8
+.byte	0xae,0xf9,0x32,0x11,	0xc7,0x29,0xa1,0x6d
+.byte	0x1d,0x9e,0x2f,0x4b,	0xdc,0xb2,0x30,0xf3
+.byte	0x0d,0x86,0x52,0xec,	0x77,0xc1,0xe3,0xd0
+.byte	0x2b,0xb3,0x16,0x6c,	0xa9,0x70,0xb9,0x99
+.byte	0x11,0x94,0x48,0xfa,	0x47,0xe9,0x64,0x22
+.byte	0xa8,0xfc,0x8c,0xc4,	0xa0,0xf0,0x3f,0x1a
+.byte	0x56,0x7d,0x2c,0xd8,	0x22,0x33,0x90,0xef
+.byte	0x87,0x49,0x4e,0xc7,	0xd9,0x38,0xd1,0xc1
+.byte	0x8c,0xca,0xa2,0xfe,	0x98,0xd4,0x0b,0x36
+.byte	0xa6,0xf5,0x81,0xcf,	0xa5,0x7a,0xde,0x28
+.byte	0xda,0xb7,0x8e,0x26,	0x3f,0xad,0xbf,0xa4
+.byte	0x2c,0x3a,0x9d,0xe4,	0x50,0x78,0x92,0x0d
+.byte	0x6a,0x5f,0xcc,0x9b,	0x54,0x7e,0x46,0x62
+.byte	0xf6,0x8d,0x13,0xc2,	0x90,0xd8,0xb8,0xe8
+.byte	0x2e,0x39,0xf7,0x5e,	0x82,0xc3,0xaf,0xf5
+.byte	0x9f,0x5d,0x80,0xbe,	0x69,0xd0,0x93,0x7c
+.byte	0x6f,0xd5,0x2d,0xa9,	0xcf,0x25,0x12,0xb3
+.byte	0xc8,0xac,0x99,0x3b,	0x10,0x18,0x7d,0xa7
+.byte	0xe8,0x9c,0x63,0x6e,	0xdb,0x3b,0xbb,0x7b
+.byte	0xcd,0x26,0x78,0x09,	0x6e,0x59,0x18,0xf4
+.byte	0xec,0x9a,0xb7,0x01,	0x83,0x4f,0x9a,0xa8
+.byte	0xe6,0x95,0x6e,0x65,	0xaa,0xff,0xe6,0x7e
+.byte	0x21,0xbc,0xcf,0x08,	0xef,0x15,0xe8,0xe6
+.byte	0xba,0xe7,0x9b,0xd9,	0x4a,0x6f,0x36,0xce
+.byte	0xea,0x9f,0x09,0xd4,	0x29,0xb0,0x7c,0xd6
+.byte	0x31,0xa4,0xb2,0xaf,	0x2a,0x3f,0x23,0x31
+.byte	0xc6,0xa5,0x94,0x30,	0x35,0xa2,0x66,0xc0
+.byte	0x74,0x4e,0xbc,0x37,	0xfc,0x82,0xca,0xa6
+.byte	0xe0,0x90,0xd0,0xb0,	0x33,0xa7,0xd8,0x15
+.byte	0xf1,0x04,0x98,0x4a,	0x41,0xec,0xda,0xf7
+.byte	0x7f,0xcd,0x50,0x0e,	0x17,0x91,0xf6,0x2f
+.byte	0x76,0x4d,0xd6,0x8d,	0x43,0xef,0xb0,0x4d
+.byte	0xcc,0xaa,0x4d,0x54,	0xe4,0x96,0x04,0xdf
+.byte	0x9e,0xd1,0xb5,0xe3,	0x4c,0x6a,0x88,0x1b
+.byte	0xc1,0x2c,0x1f,0xb8,	0x46,0x65,0x51,0x7f
+.byte	0x9d,0x5e,0xea,0x04,	0x01,0x8c,0x35,0x5d
+.byte	0xfa,0x87,0x74,0x73,	0xfb,0x0b,0x41,0x2e
+.byte	0xb3,0x67,0x1d,0x5a,	0x92,0xdb,0xd2,0x52
+.byte	0xe9,0x10,0x56,0x33,	0x6d,0xd6,0x47,0x13
+.byte	0x9a,0xd7,0x61,0x8c,	0x37,0xa1,0x0c,0x7a
+.byte	0x59,0xf8,0x14,0x8e,	0xeb,0x13,0x3c,0x89
+.byte	0xce,0xa9,0x27,0xee,	0xb7,0x61,0xc9,0x35
+.byte	0xe1,0x1c,0xe5,0xed,	0x7a,0x47,0xb1,0x3c
+.byte	0x9c,0xd2,0xdf,0x59,	0x55,0xf2,0x73,0x3f
+.byte	0x18,0x14,0xce,0x79,	0x73,0xc7,0x37,0xbf
+.byte	0x53,0xf7,0xcd,0xea,	0x5f,0xfd,0xaa,0x5b
+.byte	0xdf,0x3d,0x6f,0x14,	0x78,0x44,0xdb,0x86
+.byte	0xca,0xaf,0xf3,0x81,	0xb9,0x68,0xc4,0x3e
+.byte	0x38,0x24,0x34,0x2c,	0xc2,0xa3,0x40,0x5f
+.byte	0x16,0x1d,0xc3,0x72,	0xbc,0xe2,0x25,0x0c
+.byte	0x28,0x3c,0x49,0x8b,	0xff,0x0d,0x95,0x41
+.byte	0x39,0xa8,0x01,0x71,	0x08,0x0c,0xb3,0xde
+.byte	0xd8,0xb4,0xe4,0x9c,	0x64,0x56,0xc1,0x90
+.byte	0x7b,0xcb,0x84,0x61,	0xd5,0x32,0xb6,0x70
+.byte	0x48,0x6c,0x5c,0x74,	0xd0,0xb8,0x57,0x42
+
+.byte	0x52, 0x09, 0x6a, 0xd5, 0x30, 0x36, 0xa5, 0x38	# Td4
+.byte	0xbf, 0x40, 0xa3, 0x9e, 0x81, 0xf3, 0xd7, 0xfb
+.byte	0x7c, 0xe3, 0x39, 0x82, 0x9b, 0x2f, 0xff, 0x87
+.byte	0x34, 0x8e, 0x43, 0x44, 0xc4, 0xde, 0xe9, 0xcb
+.byte	0x54, 0x7b, 0x94, 0x32, 0xa6, 0xc2, 0x23, 0x3d
+.byte	0xee, 0x4c, 0x95, 0x0b, 0x42, 0xfa, 0xc3, 0x4e
+.byte	0x08, 0x2e, 0xa1, 0x66, 0x28, 0xd9, 0x24, 0xb2
+.byte	0x76, 0x5b, 0xa2, 0x49, 0x6d, 0x8b, 0xd1, 0x25
+.byte	0x72, 0xf8, 0xf6, 0x64, 0x86, 0x68, 0x98, 0x16
+.byte	0xd4, 0xa4, 0x5c, 0xcc, 0x5d, 0x65, 0xb6, 0x92
+.byte	0x6c, 0x70, 0x48, 0x50, 0xfd, 0xed, 0xb9, 0xda
+.byte	0x5e, 0x15, 0x46, 0x57, 0xa7, 0x8d, 0x9d, 0x84
+.byte	0x90, 0xd8, 0xab, 0x00, 0x8c, 0xbc, 0xd3, 0x0a
+.byte	0xf7, 0xe4, 0x58, 0x05, 0xb8, 0xb3, 0x45, 0x06
+.byte	0xd0, 0x2c, 0x1e, 0x8f, 0xca, 0x3f, 0x0f, 0x02
+.byte	0xc1, 0xaf, 0xbd, 0x03, 0x01, 0x13, 0x8a, 0x6b
+.byte	0x3a, 0x91, 0x11, 0x41, 0x4f, 0x67, 0xdc, 0xea
+.byte	0x97, 0xf2, 0xcf, 0xce, 0xf0, 0xb4, 0xe6, 0x73
+.byte	0x96, 0xac, 0x74, 0x22, 0xe7, 0xad, 0x35, 0x85
+.byte	0xe2, 0xf9, 0x37, 0xe8, 0x1c, 0x75, 0xdf, 0x6e
+.byte	0x47, 0xf1, 0x1a, 0x71, 0x1d, 0x29, 0xc5, 0x89
+.byte	0x6f, 0xb7, 0x62, 0x0e, 0xaa, 0x18, 0xbe, 0x1b
+.byte	0xfc, 0x56, 0x3e, 0x4b, 0xc6, 0xd2, 0x79, 0x20
+.byte	0x9a, 0xdb, 0xc0, 0xfe, 0x78, 0xcd, 0x5a, 0xf4
+.byte	0x1f, 0xdd, 0xa8, 0x33, 0x88, 0x07, 0xc7, 0x31
+.byte	0xb1, 0x12, 0x10, 0x59, 0x27, 0x80, 0xec, 0x5f
+.byte	0x60, 0x51, 0x7f, 0xa9, 0x19, 0xb5, 0x4a, 0x0d
+.byte	0x2d, 0xe5, 0x7a, 0x9f, 0x93, 0xc9, 0x9c, 0xef
+.byte	0xa0, 0xe0, 0x3b, 0x4d, 0xae, 0x2a, 0xf5, 0xb0
+.byte	0xc8, 0xeb, 0xbb, 0x3c, 0x83, 0x53, 0x99, 0x61
+.byte	0x17, 0x2b, 0x04, 0x7e, 0xba, 0x77, 0xd6, 0x26
+.byte	0xe1, 0x69, 0x14, 0x63, 0x55, 0x21, 0x0c, 0x7d
+
+AES_Te4:
+.byte	0x63, 0x7c, 0x77, 0x7b, 0xf2, 0x6b, 0x6f, 0xc5	# Te4
+.byte	0x30, 0x01, 0x67, 0x2b, 0xfe, 0xd7, 0xab, 0x76
+.byte	0xca, 0x82, 0xc9, 0x7d, 0xfa, 0x59, 0x47, 0xf0
+.byte	0xad, 0xd4, 0xa2, 0xaf, 0x9c, 0xa4, 0x72, 0xc0
+.byte	0xb7, 0xfd, 0x93, 0x26, 0x36, 0x3f, 0xf7, 0xcc
+.byte	0x34, 0xa5, 0xe5, 0xf1, 0x71, 0xd8, 0x31, 0x15
+.byte	0x04, 0xc7, 0x23, 0xc3, 0x18, 0x96, 0x05, 0x9a
+.byte	0x07, 0x12, 0x80, 0xe2, 0xeb, 0x27, 0xb2, 0x75
+.byte	0x09, 0x83, 0x2c, 0x1a, 0x1b, 0x6e, 0x5a, 0xa0
+.byte	0x52, 0x3b, 0xd6, 0xb3, 0x29, 0xe3, 0x2f, 0x84
+.byte	0x53, 0xd1, 0x00, 0xed, 0x20, 0xfc, 0xb1, 0x5b
+.byte	0x6a, 0xcb, 0xbe, 0x39, 0x4a, 0x4c, 0x58, 0xcf
+.byte	0xd0, 0xef, 0xaa, 0xfb, 0x43, 0x4d, 0x33, 0x85
+.byte	0x45, 0xf9, 0x02, 0x7f, 0x50, 0x3c, 0x9f, 0xa8
+.byte	0x51, 0xa3, 0x40, 0x8f, 0x92, 0x9d, 0x38, 0xf5
+.byte	0xbc, 0xb6, 0xda, 0x21, 0x10, 0xff, 0xf3, 0xd2
+.byte	0xcd, 0x0c, 0x13, 0xec, 0x5f, 0x97, 0x44, 0x17
+.byte	0xc4, 0xa7, 0x7e, 0x3d, 0x64, 0x5d, 0x19, 0x73
+.byte	0x60, 0x81, 0x4f, 0xdc, 0x22, 0x2a, 0x90, 0x88
+.byte	0x46, 0xee, 0xb8, 0x14, 0xde, 0x5e, 0x0b, 0xdb
+.byte	0xe0, 0x32, 0x3a, 0x0a, 0x49, 0x06, 0x24, 0x5c
+.byte	0xc2, 0xd3, 0xac, 0x62, 0x91, 0x95, 0xe4, 0x79
+.byte	0xe7, 0xc8, 0x37, 0x6d, 0x8d, 0xd5, 0x4e, 0xa9
+.byte	0x6c, 0x56, 0xf4, 0xea, 0x65, 0x7a, 0xae, 0x08
+.byte	0xba, 0x78, 0x25, 0x2e, 0x1c, 0xa6, 0xb4, 0xc6
+.byte	0xe8, 0xdd, 0x74, 0x1f, 0x4b, 0xbd, 0x8b, 0x8a
+.byte	0x70, 0x3e, 0xb5, 0x66, 0x48, 0x03, 0xf6, 0x0e
+.byte	0x61, 0x35, 0x57, 0xb9, 0x86, 0xc1, 0x1d, 0x9e
+.byte	0xe1, 0xf8, 0x98, 0x11, 0x69, 0xd9, 0x8e, 0x94
+.byte	0x9b, 0x1e, 0x87, 0xe9, 0xce, 0x55, 0x28, 0xdf
+.byte	0x8c, 0xa1, 0x89, 0x0d, 0xbf, 0xe6, 0x42, 0x68
+.byte	0x41, 0x99, 0x2d, 0x0f, 0xb0, 0x54, 0xbb, 0x16
+
+.byte	0x01,0x00,0x00,0x00,	0x02,0x00,0x00,0x00	# rcon
+.byte	0x04,0x00,0x00,0x00,	0x08,0x00,0x00,0x00
+.byte	0x10,0x00,0x00,0x00,	0x20,0x00,0x00,0x00
+.byte	0x40,0x00,0x00,0x00,	0x80,0x00,0x00,0x00
+.byte	0x1B,0x00,0x00,0x00,	0x36,0x00,0x00,0x00
+___
+
+$code =~ s/\`([^\`]*)\`/eval $1/gem;
+
+print $code;
+
+close STDOUT;
+
diff --git a/crypto/aes/build.info b/crypto/aes/build.info
index 0f04863..b5d9b80 100644
--- a/crypto/aes/build.info
+++ b/crypto/aes/build.info
@@ -40,6 +40,9 @@ GENERATE[aes-parisc.s]=asm/aes-parisc.pl $(PERLASM_SCHEME)
 GENERATE[aes-mips.S]=asm/aes-mips.pl $(PERLASM_SCHEME)
 INCLUDE[aes-mips.o]=..
 
+GENERATE[aes-loongarch.S]=asm/aes-loongarch.pl $(PERLASM_SCHEME)
+INCLUDE[aes-loongarch.o]=..
+
 GENERATE[aesv8-armx.S]=asm/aesv8-armx.pl $(PERLASM_SCHEME)
 INCLUDE[aesv8-armx.o]=..
 GENERATE[vpaes-armv8.S]=asm/vpaes-armv8.pl $(PERLASM_SCHEME)
-- 
2.20.1

